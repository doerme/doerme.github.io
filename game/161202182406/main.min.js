var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var i=(__define,t),s=i.prototype;return s.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},s.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.onAddToStage=function(e){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},s.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},s.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},s.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},s.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},s.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},s.createGameScene=function(){var e=new material.GameContainer;this.addChild(e)},t}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var material;!function(e){var t=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.onAddToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight;var t=new egret.Bitmap;t.texture=RES.getRes("map_2_jpg"),t.fillMode=egret.BitmapFillMode.REPEAT,t.width=this.stageW,t.height=this.stageW,t.alpha=.4,this.addChild(t)},t}(egret.DisplayObjectContainer);e.BgMap=t,egret.registerClass(t,"material.BgMap")}(material||(material={}));var material;!function(e){var t=function(t){function i(e,i){t.call(this,e),this.xCache=0,this.yCache=0,this.textureName=i}__extends(i,t);var s=(__define,i);s.prototype;return i.produce=function(t){null==e.Bomb.cacheDict[t]&&(e.Bomb.cacheDict[t]=[]);var i,s=e.Bomb.cacheDict[t];return i=s.length>0?s.pop():new e.Bomb(RES.getRes(t),t)},i.reclaim=function(t){var i=t.textureName;null==e.Bomb.cacheDict[i]&&(e.Bomb.cacheDict[i]=[]);var s=e.Bomb.cacheDict[i];-1==s.indexOf(t)&&s.push(t)},i.cacheDict={},i}(egret.Bitmap);e.Bomb=t,egret.registerClass(t,"material.Bomb")}(material||(material={}));var material;!function(e){var t=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.onAddToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight,this.ctrlBomb=new egret.Bitmap,this.ctrlBomb.texture=RES.getRes("bomb_png"),this.ctrlBomb.x=this.stageW-250,this.ctrlBomb.y=this.stageW+100,this.ctrlBomb.width=200,this.ctrlBomb.height=200,this.ctrlBomb.alpha=0,this.addChild(this.ctrlBomb),this.label=new egret.TextField,this.label.textColor=16711680,this.label.width=70,this.label.height=70,this.label.size=50,this.addChild(this.label)},s.showCtrlBomb=function(){this.ctrlBomb.alpha=1,this.label.alpha=1},s.hideCtrlBomb=function(){this.ctrlBomb.alpha=0,this.label.alpha=0},s.setCtrlBomb=function(e){if(console.log("setCtrlBomb",e),0>=e)this.hideCtrlBomb();else{this.showCtrlBomb();var t=this.stageW-250,i=this.stageW+100;this.label.x=t,this.label.y=i,this.label.text=e.toString(),egret.Tween.get(this.ctrlBomb).to({scaleX:.8,scaleY:.8,x:t+20,y:i+20},500,egret.Ease.circIn).to({scaleX:1,scaleY:1,x:t,y:i},500,egret.Ease.circIn)}},t}(egret.DisplayObjectContainer);e.CtrlBomb=t,egret.registerClass(t,"material.CtrlBomb")}(material||(material={}));var material;!function(e){var t=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.onAddToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight;var t=new egret.Shape;t.x=150,t.y=this.stageW+200,t.graphics.beginFill(14540253,1),t.graphics.drawCircle(0,0,100),t.graphics.endFill(),this.addChild(t)},t}(egret.DisplayObjectContainer);e.CtrlLever=t,egret.registerClass(t,"material.CtrlLever")}(material||(material={}));var material;!function(e){var t=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.onAddToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight,this.curFire=new egret.Bitmap,this.curFire.texture=RES.getRes("big-fire_png"),this.curFire.x=0,this.curFire.y=0,this.curFire.width=60,this.curFire.height=60,this.addChild(this.curFire)},t}(egret.DisplayObjectContainer);e.Fire=t,egret.registerClass(t,"material.Fire")}(material||(material={}));var material;!function(e){var t=function(t){function i(){t.call(this),this.bombResource=[],this.throwBombResource=[],this.fireFlowerResource=[],this.restTimelabelResource=[],this.fireResource=[],this._gameStart=!1,this._touchStatus=!1,this._lastTime=egret.getTimer(),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(i,t);var s=(__define,i),r=s.prototype;return r.onAddToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.createGameScene()},r.createGameScene=function(){this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight,this.gameWrap=new e.GameWrap,this.addChild(this.gameWrap),this.bg=new e.BgMap,this.addChild(this.bg),this.ctrlLever=new e.CtrlLever,this.addChild(this.ctrlLever),this.ctrlBomb=new e.CtrlBomb,this.addChild(this.ctrlBomb),this.ctrlLever.touchEnabled=!0,this.ctrlLever.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchStart,this),this.ctrlLever.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.gameStart,this),this.ctrlLever.addEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.ctrlLever.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.touchEnd,this),this.gameWrap.touchEnabled=!0,this.gameWrap.addEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.gameWrap.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.touchEnd,this),this.ctrlBomb.$touchEnabled=!0,this.ctrlBomb.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.throwBomb,this),this._ctrlGuide=new egret.Shape,this._ctrlGuide.x=150,this._ctrlGuide.y=this.stageW+200,this._ctrlGuide.graphics.beginFill(2856673,1),this._ctrlGuide.graphics.drawCircle(0,0,50),this._ctrlGuide.graphics.endFill(),this._ctrlGuide.alpha=0,this.addChild(this._ctrlGuide),this.pumpkin=new e.Pumpkin,this.pumpkin.x=this.stageW/2,this.pumpkin.y=this.stageW/2,this.addChild(this.pumpkin)},r.touchStart=function(e){console.log("touchStart"),this._touchStatus=!0,this._ctrlGuide.alpha=1,this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this)},r.touchEnd=function(e){this._touchStatus=!1,this._ctrlGuide.alpha=0,this.pumpkin.speedX=0,this.pumpkin.speedY=0,this.pumpkin.seStop()},r.touchMove=function(e){if(this._touchStatus){var t=150,i=this.stageW+200,s=100,r=e.stageX,h=e.stageY,n=r,a=h,o=Math.sqrt(Math.pow(t-r,2)+Math.pow(i-h,2));o>s&&(r>t&&i>h&&(n=t+100*(r-t)/o,a=i+100*(h-i)/o),t>r&&i>h&&(n=t-100*(t-r)/o,a=i+100*(h-i)/o),t>r&&h>i&&(n=t-100*(t-r)/o,a=i+100*(h-i)/o),r>t&&h>i&&(n=t+100*(r-t)/o,a=i+100*(h-i)/o)),this._ctrlGuide.x=n,this._ctrlGuide.y=a,r>t&&i>h&&(this.pumpkin.speedX=this.pumpkin.speed*(r-t)*100/o,this.pumpkin.speedY=this.pumpkin.speed*(h-i)*100/o,this.pumpkin.setRunRight()),t>r&&i>h&&(this.pumpkin.speedX=-this.pumpkin.speed*(t-r)*100/o,this.pumpkin.speedY=this.pumpkin.speed*(h-i)*100/o,this.pumpkin.setRunLeft()),t>r&&h>i&&(this.pumpkin.speedX=-this.pumpkin.speed*(t-r)*100/o,this.pumpkin.speedY=this.pumpkin.speed*(h-i)*100/o,this.pumpkin.setRunLeft()),r>t&&h>i&&(this.pumpkin.speedX=this.pumpkin.speed*(r-t)*100/o,this.pumpkin.speedY=this.pumpkin.speed*(h-i)*100/o,this.pumpkin.setRunRight())}},r.gameStart=function(){this._gameStart||(this._gameStart=!0,this.addEventListener(egret.Event.ENTER_FRAME,this.gameViewUpdate,this),this.sessionStart())},r.gameViewUpdate=function(e){var t=egret.getTimer(),i=(1e3/(t-this._lastTime),t-this._lastTime);this._lastTime=t;this.drawPumpkin(i),this.fireFloweMove(),this.fireMove(),this.bombExplode(t),this.gameHitTest()},r.sessionStart=function(){console.log("sessionStart");var e=new egret.Timer(1500,30);e.addEventListener(egret.TimerEvent.TIMER,this.createBomb,this),e.start()},r.createBomb=function(){var t;t=e.Bomb.produce("bomb_png"),t.width=60,t.height=60,t.x=t.width+Math.random()*(this.stageW-2*t.width),t.y=t.width+Math.random()*(this.stageW-2*t.width),this.addChild(t),this.bombResource.push(t),console.log("add bomb ",t)},r.throwBomb=function(){if(!(this.pumpkin.havebomb<=0)){var t;t=e.Bomb.produce("bomb_png"),t.width=60,t.height=60,t.x=this.pumpkin.x-this.pumpkin.width/2,t.y=this.pumpkin.y-this.pumpkin.height/2,t.setTime=egret.getTimer(),t.lastTime=3e3,this.addChild(t),this.throwBombResource.push(t),this.pumpkin.havebomb--,this.ctrlBomb.setCtrlBomb(this.pumpkin.havebomb);var i;i=e.Bomb.produce("fire_png"),i.width=20,i.height=20,i.x=this.pumpkin.x-this.pumpkin.width/2+30,i.y=this.pumpkin.y-this.pumpkin.height/2-5,i.xCache=i.x,i.yCache=i.y,i.setTime=egret.getTimer(),i.lastTime=t.lastTime,this.addChild(i),this.fireFlowerResource.push(i);var s;s=new e.GameLabel(i.lastTime.toString()),s.x=this.pumpkin.x-20,s.y=this.pumpkin.y-80,this.addChild(s),this.restTimelabelResource.push(s)}},r.fireFloweMove=function(){for(var e in this.fireFlowerResource)this.fireFlowerResource[e].x=this.fireFlowerResource[e].xCache-5+10*Math.random(),this.fireFlowerResource[e].y=this.fireFlowerResource[e].yCache-5+10*Math.random()},r.fireMove=function(){for(var e in this.fireResource)this.fireResource[e].x=this.fireResource[e].xCache-5+10*Math.random(),this.fireResource[e].y=this.fireResource[e].yCache-5+10*Math.random()},r.bombExplode=function(t){for(var i in this.throwBombResource){var s=this.throwBombResource[i].setTime+this.throwBombResource[i].lastTime-t;s>0?(console.log(s),this.restTimelabelResource[i].setText(Math.floor(s/10).toString())):(console.log("explode"),this.fireExplode(t,this.throwBombResource[i]),e.Bomb.reclaim(this.throwBombResource[i]),this.removeChild(this.throwBombResource[i]),this.throwBombResource.splice(parseInt(i),1),e.Bomb.reclaim(this.fireFlowerResource[i]),this.removeChild(this.fireFlowerResource[i]),this.fireFlowerResource.splice(parseInt(i),1),this.removeChild(this.restTimelabelResource[i]),this.restTimelabelResource.splice(parseInt(i),1))}},r.fireExplode=function(t,i){var s=new e.Fire,r=60;s.setTime=egret.getTimer(),s.lastTime=1e3,s.xCache=i.x,s.x=i.x,s.yCache=i.y,s.y=i.y,this.addChild(s),this.fireResource.push(s);for(var h=0;h<this.pumpkin.fireable;h++){var s=new e.Fire,r=50;s.setTime=egret.getTimer(),s.lastTime=1e3,s.xCache=i.x-(h+1)*r,s.x=i.x-(h+1)*r,s.yCache=i.y,s.y=i.y,this.addChild(s),this.fireResource.push(s);var s=new e.Fire,r=60;s.setTime=egret.getTimer(),s.lastTime=1e3,s.xCache=i.x+(h+1)*r,s.x=i.x+(h+1)*r,s.yCache=i.y,s.y=i.y,this.addChild(s),this.fireResource.push(s);var s=new e.Fire,r=60;s.setTime=egret.getTimer(),s.lastTime=1e3,s.xCache=i.x,s.x=i.x,s.yCache=i.y-(h+1)*r,s.y=i.y-(h+1)*r,this.addChild(s),this.fireResource.push(s);var s=new e.Fire,r=60;s.setTime=egret.getTimer(),s.lastTime=1e3,s.xCache=i.x,s.x=i.x,s.yCache=i.y+(h+1)*r,s.y=i.y+(h+1)*r,this.addChild(s),this.fireResource.push(s)}},r.drawPumpkin=function(e){if(e>60&&(e=60),this.pumpkin.speedX&&this.pumpkin.speedY){var t=this.pumpkin.speedX*e/1e3,i=this.pumpkin.speedY*e/1e3;this.pumpkin.x=this.pumpkin.x+t,this.pumpkin.y=this.pumpkin.y+i,this.pumpkin.x<this.pumpkin.width&&(console.log("fzq 1",e,this.pumpkin.x,this.pumpkin.y),this.pumpkin.x=this.pumpkin.width),this.pumpkin.x>this.stageW-this.pumpkin.width&&(console.log("fzq 2",e,this.pumpkin.x,this.pumpkin.y),this.pumpkin.x=this.stageW-this.pumpkin.width),this.pumpkin.y<this.pumpkin.height&&(console.log("fzq 3",e,this.pumpkin.x,this.pumpkin.y),this.pumpkin.y=this.pumpkin.height),this.pumpkin.y>this.stageW-this.pumpkin.height&&(console.log("fzq 4",e,this.pumpkin.x,this.pumpkin.y),this.pumpkin.y=this.stageW-this.pumpkin.height),this.pumpkin.walked+=Math.sqrt(t*t+i*i)}},r.gameHitTest=function(){for(var t in this.bombResource)e.GameUtil.hitRoundTest(this.bombResource[t],this.pumpkin)&&(this.pumpkin.havebomb+=10,console.log("hit",this.pumpkin.havebomb),this.ctrlBomb.setCtrlBomb(this.pumpkin.havebomb),e.Bomb.reclaim(this.bombResource[t]),this.removeChild(this.bombResource[t]),this.bombResource.splice(parseInt(t),1))},i}(egret.DisplayObjectContainer);e.GameContainer=t,egret.registerClass(t,"material.GameContainer")}(material||(material={}));var material;!function(e){var t=function(e){function t(t){e.call(this),this.contentText=t,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.onAddToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight,this.olabel=new egret.TextField,this.olabel.x=0,this.olabel.y=0,this.olabel.textColor=16711680,this.olabel.height=70,this.olabel.size=30,this.olabel.text=this.contentText,this.addChild(this.olabel)},s.setText=function(e){this.olabel.text=e},t}(egret.DisplayObjectContainer);e.GameLabel=t,egret.registerClass(t,"material.GameLabel")}(material||(material={}));var material;!function(e){var t=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.onAddToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight;var t=new egret.Shape;t.graphics.beginFill(16777215,1),t.graphics.drawRect(0,0,this.stageW,this.stageH),t.graphics.endFill(),this.addChild(t)},t}(egret.DisplayObjectContainer);e.GameWrap=t,egret.registerClass(t,"material.GameWrap")}(material||(material={}));var material;!function(e){var t=function(e){function t(){e.call(this),this.havebomb=0,this.fireable=2,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.onAddToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight,this.speed=2;var t=RES.getRes("cat_json"),i=RES.getRes("cat_png"),s=new egret.MovieClipDataFactory(t,i);this.runner=new egret.MovieClip(s.generateMovieClipData("cat")),this.runner.x=-this.runner.width/2,this.runner.y=-this.runner.height/2,this.seStop(),this.addChild(this.runner)},s.setRunRight=function(){"right"!=this.runnerState&&(this.runnerState="right",this.runner.x=-this.runner.width/2,this.runner.y=-this.runner.height/2,this.runner.scaleX=1,this.runner.gotoAndPlay("run",-1))},s.setRunLeft=function(){"left"!=this.runnerState&&(this.runnerState="left",this.runner.x=+this.runner.width/2,this.runner.y=-this.runner.height/2,this.runner.scaleX=-1,this.runner.gotoAndPlay("run",-1))},s.seStop=function(){"stop"!=this.runnerState&&(this.runnerState="stop",this.runner.gotoAndPlay("stop",-1))},t}(egret.DisplayObjectContainer);e.Pumpkin=t,egret.registerClass(t,"material.Pumpkin")}(material||(material={}));var material;!function(e){var t=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.onAddToStage=function(e){this.drawShadow(this.x,this.y,this.offsetY,5)},s.drawShadow=function(e,t,i,s){var r=new egret.Shape;r.graphics.beginFill(3355443);var h=i>s?1/i:1/s;r.graphics.moveTo(e+i,t);for(var n=0;n<2*Math.PI;n+=h)r.graphics.lineTo(e+i*Math.cos(n),t+s*Math.sin(n));r.graphics.endFill(),this.addChild(r)},t}(egret.DisplayObjectContainer);e.Shadow=t,egret.registerClass(t,"material.Shadow")}(material||(material={}));var material;!function(e){function t(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t}var i=function(){function e(){}var t=(__define,e);t.prototype;return e.hitTest=function(e,t){var i=e.getBounds(),s=t.getBounds();return i.x=e.x,i.y=e.y,s.x=t.x,s.y=t.y,i.intersects(s)},e.hitRoundTest=function(e,t){var i=e.x-t.x,s=e.y-t.y,r=Math.sqrt(i*i+s*s);return r<(e.width+t.width)/2?!0:!1},e}();e.GameUtil=i,egret.registerClass(i,"material.GameUtil"),e.createBitmapByName=t}(material||(material={}));